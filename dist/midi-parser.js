(()=>{var x=Object.create;var w=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var M=(s,d)=>()=>(d||s((d={exports:{}}).exports,d),d.exports);var P=(s,d,u,f)=>{if(d&&typeof d=="object"||typeof d=="function")for(let n of y(d))!L.call(s,n)&&n!==u&&w(s,n,{get:()=>d[n],enumerable:!(f=m(d,n))||f.enumerable});return s};var U=(s,d,u)=>(u=s!=null?x(T(s)):{},P(d||!s||!s.__esModule?w(u,"default",{value:s,enumerable:!0}):u,s));var g=M((F,I)=>{(function(){"use strict";let s={fatal:!0},d=[new TextDecoder("sjis",s),new TextDecoder("euc-jp",s),new TextDecoder("utf-8")],u=function(n){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;if(n=n.replace(/^.*?base64,/,""),n=String(n).replace(/[\t\n\f\r ]+/g,""),!h.test(n))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");n+="==".slice(2-(n.length&3));let e,o="",v,t,i=0;for(;i<n.length;)e=a.indexOf(n.charAt(i++))<<18|a.indexOf(n.charAt(i++))<<12|(v=a.indexOf(n.charAt(i++)))<<6|(t=a.indexOf(n.charAt(i++))),o+=v===64?String.fromCharCode(e>>16&255):t===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,e&255);return o},f={debug:!1,parse:function(n,a){if(n instanceof Uint8Array)return f.Uint8(n);if(typeof n=="string")return f.Base64(n);if(n instanceof HTMLElement&&n.type==="file")return f.addListener(n,a);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(n,a){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(n===void 0||!(n instanceof HTMLElement)||n.tagName!=="INPUT"||n.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;a=a||function(){},n.addEventListener("change",function(h){if(!h.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let e=new FileReader;e.readAsArrayBuffer(h.target.files[0]),e.onload=function(o){a(f.Uint8(new Uint8Array(o.target.result)))}})},Base64:function(n){n=String(n);let a=u(n),h=a.length,e=new Uint8Array(new ArrayBuffer(h));for(let o=0;o<h;o++)e[o]=a.charCodeAt(o);return f.Uint8(e)},Uint8:function(n){let a={data:null,pointer:0,movePointer:function(t){return this.pointer+=t,this.pointer},readInt:function(t){if(t=Math.min(t,this.data.byteLength-this.pointer),t<1)return-1;let i=0;if(t>1)for(let r=1;r<=t-1;r++)i+=this.data.getUint8(this.pointer)*Math.pow(256,t-r),this.pointer++;return i+=this.data.getUint8(this.pointer),this.pointer++,i},readStr:function(t){let i="",r=!1;for(let l=0;l<d.length;l++)try{r||(i=d[l].decode(t))}catch{console.error(`Decoding with ${d[l].encoding?.toUpperCase()} failed.`)}return i},backOne:function(){this.pointer--},readIntVLV:function(){let t=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)t=this.readInt(1);else{let i=[];for(;this.data.getUint8(this.pointer)>=128;)i.push(this.readInt(1)-128);let r=this.readInt(1);for(let l=1;l<=i.length;l++)t+=i[i.length-l]*Math.pow(128,l);t+=r}return t}};if(a.data=new DataView(n.buffer,n.byteOffset,n.byteLength),a.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;let h=a.readInt(4),e={};e.formatType=a.readInt(2),e.tracks=a.readInt(2),e.track=[];let o=a.readInt(1),v=a.readInt(1);o>=128?(e.timeDivision=[],e.timeDivision[0]=o-128,e.timeDivision[1]=v):e.timeDivision=o*256+v;for(let t=1;t<=e.tracks;t++){e.track[t-1]={event:[]};let i=a.readInt(4);if(i===-1)break;if(i!==1297379947)return!1;a.readInt(4);let r=0,l=!1,c,k;for(;!l&&(r++,e.track[t-1].event[r-1]={},e.track[t-1].event[r-1].deltaTime=a.readIntVLV(),c=a.readInt(1),c!==-1);)if(c>=128?k=c:(c=k,a.movePointer(-1)),c===255){e.track[t-1].event[r-1].type=255,e.track[t-1].event[r-1].metaType=a.readInt(1);let p=a.readIntVLV();switch(e.track[t-1].event[r-1].metaType){case 47:case-1:l=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:e.track[t-1].event[r-1].data=a.readStr(p);break;case 33:case 89:case 81:e.track[t-1].event[r-1].data=a.readInt(p);break;case 84:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1),e.track[t-1].event[r-1].data[4]=a.readInt(1);break;case 88:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1);break;default:this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,p)),(this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)&&(a.readInt(p),e.track[t-1].event[r-1].data=a.readInt(p),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(c=c.toString(16).split(""),c[1]||c.unshift("0"),e.track[t-1].event[r-1].type=parseInt(c[0],16),e.track[t-1].event[r-1].channel=parseInt(c[1],16),e.track[t-1].event[r-1].type){case 15:{if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].type,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1){let p=a.readIntVLV();e.track[t-1].event[r-1].data=a.readInt(p),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break}case 10:case 11:case 14:case 8:case 9:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1);break;case 12:case 13:e.track[t-1].event[r-1].data=a.readInt(1);break;case-1:l=!0;break;default:if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return e},customInterpreter:null};if(typeof I<"u")I.exports=f;else{let n=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;n.MidiParser=f}})()});var B=U(g()),b=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global,A=b.MidiParser;delete b.MidiParser;})();
