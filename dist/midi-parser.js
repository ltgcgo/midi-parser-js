(()=>{var b=Object.create;var I=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var L=(d,i)=>()=>(i||d((i={exports:{}}).exports,i),i.exports);var M=(d,i,n,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of m(i))!y.call(d,o)&&o!==n&&I(d,o,{get:()=>i[o],enumerable:!(a=g(i,o))||a.enumerable});return d};var P=(d,i,n)=>(n=d!=null?b(x(d)):{},M(i||!d||!d.__esModule?I(n,"default",{value:d,enumerable:!0}):n,d));var k=L((T,p)=>{(function(){"use strict";let d=function(n){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;if(n=n.replace(/^.*?base64,/,""),n=String(n).replace(/[\t\n\f\r ]+/g,""),!o.test(n))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");n+="==".slice(2-(n.length&3));let e,l="",u,t,s=0;for(;s<n.length;)e=a.indexOf(n.charAt(s++))<<18|a.indexOf(n.charAt(s++))<<12|(u=a.indexOf(n.charAt(s++)))<<6|(t=a.indexOf(n.charAt(s++))),l+=u===64?String.fromCharCode(e>>16&255):t===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,e&255);return l},i={debug:!1,parse:function(n,a){if(n instanceof Uint8Array)return i.Uint8(n);if(typeof n=="string")return i.Base64(n);if(n instanceof HTMLElement&&n.type==="file")return i.addListener(n,a);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(n,a){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(n===void 0||!(n instanceof HTMLElement)||n.tagName!=="INPUT"||n.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;a=a||function(){},n.addEventListener("change",function(o){if(!o.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let e=new FileReader;e.readAsArrayBuffer(o.target.files[0]),e.onload=function(l){a(i.Uint8(new Uint8Array(l.target.result)))}})},Base64:function(n){n=String(n);let a=d(n),o=a.length,e=new Uint8Array(new ArrayBuffer(o));for(let l=0;l<o;l++)e[l]=a.charCodeAt(l);return i.Uint8(e)},Uint8:function(n){let a={data:null,pointer:0,movePointer:function(t){return this.pointer+=t,this.pointer},readInt:function(t){if(t=Math.min(t,this.data.byteLength-this.pointer),t<1)return-1;let s=0;if(t>1)for(let r=1;r<=t-1;r++)s+=this.data.getUint8(this.pointer)*Math.pow(256,t-r),this.pointer++;return s+=this.data.getUint8(this.pointer),this.pointer++,s},readStr:function(t){return Uint8Array.from(t)},backOne:function(){this.pointer--},readIntVLV:function(){let t=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)t=this.readInt(1);else{let s=[];for(;this.data.getUint8(this.pointer)>=128;)s.push(this.readInt(1)-128);let r=this.readInt(1);for(let f=1;f<=s.length;f++)t+=s[s.length-f]*Math.pow(128,f);t+=r}return t}};if(a.data=new DataView(n.buffer,n.byteOffset,n.byteLength),a.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;let o=a.readInt(4),e={};e.formatType=a.readInt(2),e.tracks=a.readInt(2),e.track=[];let l=a.readInt(1),u=a.readInt(1);l>=128?(e.timeDivision=[],e.timeDivision[0]=l-128,e.timeDivision[1]=u):e.timeDivision=l*256+u;for(let t=1;t<=e.tracks;t++){e.track[t-1]={event:[]};let s=a.readInt(4);if(s===-1)break;if(s!==1297379947)return!1;a.readInt(4);let r=0,f=!1,c,v;for(;!f&&(r++,e.track[t-1].event[r-1]={},e.track[t-1].event[r-1].deltaTime=a.readIntVLV(),c=a.readInt(1),c!==-1);)if(c>=128?v=c:(c=v,a.movePointer(-1)),c===255){e.track[t-1].event[r-1].type=255,e.track[t-1].event[r-1].metaType=a.readInt(1);let h=a.readIntVLV();switch(e.track[t-1].event[r-1].metaType){case 47:case-1:f=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:e.track[t-1].event[r-1].data=a.readStr(h);break;case 33:case 89:case 81:e.track[t-1].event[r-1].data=a.readInt(h);break;case 84:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1),e.track[t-1].event[r-1].data[4]=a.readInt(1);break;case 88:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1);break;default:this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,h)),(this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)&&(a.readInt(h),e.track[t-1].event[r-1].data=a.readInt(h),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(c=c.toString(16).split(""),c[1]||c.unshift("0"),e.track[t-1].event[r-1].type=parseInt(c[0],16),e.track[t-1].event[r-1].channel=parseInt(c[1],16),e.track[t-1].event[r-1].type){case 15:{if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].type,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1){let h=a.readIntVLV();e.track[t-1].event[r-1].data=a.readInt(h),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break}case 10:case 11:case 14:case 8:case 9:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1);break;case 12:case 13:e.track[t-1].event[r-1].data=a.readInt(1);break;case-1:f=!0;break;default:if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return e},customInterpreter:null};if(typeof p<"u")p.exports=i;else{let n=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;n.MidiParser=i}})()});var F=P(k()),w=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global,A=w.MidiParser;delete w.MidiParser;})();
