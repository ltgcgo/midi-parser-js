(()=>{var x=(v,l)=>()=>(l||v((l={exports:{}}).exports,l),l.exports);var m=x((g,p)=>{(function(){"use strict";let v={fatal:!0},l=[new TextDecoder("sjis",v),new TextDecoder("euc-jp",v),new TextDecoder("utf-8")],k=function(n){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;if(n=n.replace(/^.*?base64,/,""),n=String(n).replace(/[\t\n\f\r ]+/g,""),!c.test(n))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");n+="==".slice(2-(n.length&3));let e,s="",u,t,i=0;for(;i<n.length;)e=a.indexOf(n.charAt(i++))<<18|a.indexOf(n.charAt(i++))<<12|(u=a.indexOf(n.charAt(i++)))<<6|(t=a.indexOf(n.charAt(i++))),s+=u===64?String.fromCharCode(e>>16&255):t===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,e&255);return s},f={debug:!1,parse:function(n,a){if(n instanceof Uint8Array)return f.Uint8(n);if(typeof n=="string")return f.Base64(n);if(n instanceof HTMLElement&&n.type==="file")return f.addListener(n,a);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(n,a){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(n===void 0||!(n instanceof HTMLElement)||n.tagName!=="INPUT"||n.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;a=a||function(){},n.addEventListener("change",function(c){if(!c.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let e=new FileReader;e.readAsArrayBuffer(c.target.files[0]),e.onload=function(s){a(f.Uint8(new Uint8Array(s.target.result)))}})},Base64:function(n){n=String(n);let a=k(n),c=a.length,e=new Uint8Array(new ArrayBuffer(c));for(let s=0;s<c;s++)e[s]=a.charCodeAt(s);return f.Uint8(e)},Uint8:function(n){let a={data:null,pointer:0,movePointer:function(t){return this.pointer+=t,this.pointer},readInt:function(t){if(t=Math.min(t,this.data.byteLength-this.pointer),t<1)return-1;let i=0;if(t>1)for(let r=1;r<=t-1;r++)i+=this.data.getUint8(this.pointer)*Math.pow(256,t-r),this.pointer++;return i+=this.data.getUint8(this.pointer),this.pointer++,i},readStr:function(t){let i="",r=!1,o=Uint8Array.from(t);for(let d=0;d<l.length;d++)try{r||(i=l[d].decode(o),r=!0)}catch{console.error(`Decoding with ${l[d].encoding?.toUpperCase()} failed.`)}return i},backOne:function(){this.pointer--},readIntVLV:function(){let t=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)t=this.readInt(1);else{let i=[];for(;this.data.getUint8(this.pointer)>=128;)i.push(this.readInt(1)-128);let r=this.readInt(1);for(let o=1;o<=i.length;o++)t+=i[i.length-o]*Math.pow(128,o);t+=r}return t}};if(a.data=new DataView(n.buffer,n.byteOffset,n.byteLength),a.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;let c=a.readInt(4),e={};e.formatType=a.readInt(2),e.tracks=a.readInt(2),e.track=[];let s=a.readInt(1),u=a.readInt(1);s>=128?(e.timeDivision=[],e.timeDivision[0]=s-128,e.timeDivision[1]=u):e.timeDivision=s*256+u;for(let t=1;t<=e.tracks;t++){e.track[t-1]={event:[]};let i=a.readInt(4);if(i===-1)break;if(i!==1297379947)return!1;a.readInt(4);let r=0,o=!1,d,I;for(;!o&&(r++,e.track[t-1].event[r-1]={},e.track[t-1].event[r-1].deltaTime=a.readIntVLV(),d=a.readInt(1),d!==-1);)if(d>=128?I=d:(d=I,a.movePointer(-1)),d===255){e.track[t-1].event[r-1].type=255,e.track[t-1].event[r-1].metaType=a.readInt(1);let h=a.readIntVLV();switch(e.track[t-1].event[r-1].metaType){case 47:case-1:o=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:e.track[t-1].event[r-1].data=a.readStr(h);break;case 33:case 89:case 81:e.track[t-1].event[r-1].data=a.readInt(h);break;case 84:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1),e.track[t-1].event[r-1].data[4]=a.readInt(1);break;case 88:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1);break;default:this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,h)),(this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)&&(a.readInt(h),e.track[t-1].event[r-1].data=a.readInt(h),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(d=d.toString(16).split(""),d[1]||d.unshift("0"),e.track[t-1].event[r-1].type=parseInt(d[0],16),e.track[t-1].event[r-1].channel=parseInt(d[1],16),e.track[t-1].event[r-1].type){case 15:{if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].type,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1){let h=a.readIntVLV();e.track[t-1].event[r-1].data=a.readInt(h),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break}case 10:case 11:case 14:case 8:case 9:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1);break;case 12:case 13:e.track[t-1].event[r-1].data=a.readInt(1);break;case-1:o=!0;break;default:if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return e},customInterpreter:null};if(typeof p<"u")p.exports=f;else{let n=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;n.MidiParser=f}})()});m();})();
