(()=>{var k=(u,s)=>()=>(s||u((s={exports:{}}).exports,s),s.exports);var p=k((w,I)=>{(function(){"use strict";let u=function(n){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;if(n=n.replace(/^.*?base64,/,""),n=String(n).replace(/[\t\n\f\r ]+/g,""),!c.test(n))throw new TypeError("Failed to execute _atob() : The string to be decoded is not correctly encoded.");n+="==".slice(2-(n.length&3));let e,d="",h,t,i=0;for(;i<n.length;)e=a.indexOf(n.charAt(i++))<<18|a.indexOf(n.charAt(i++))<<12|(h=a.indexOf(n.charAt(i++)))<<6|(t=a.indexOf(n.charAt(i++))),d+=h===64?String.fromCharCode(e>>16&255):t===64?String.fromCharCode(e>>16&255,e>>8&255):String.fromCharCode(e>>16&255,e>>8&255,e&255);return d},s={debug:!1,parse:function(n,a){if(n instanceof Uint8Array)return s.Uint8(n);if(typeof n=="string")return s.Base64(n);if(n instanceof HTMLElement&&n.type==="file")return s.addListener(n,a);throw new Error("MidiParser.parse() : Invalid input provided")},addListener:function(n,a){if(!File||!FileReader)throw new Error("The File|FileReader APIs are not supported in this browser. Use instead MidiParser.Base64() or MidiParser.Uint8()");if(n===void 0||!(n instanceof HTMLElement)||n.tagName!=="INPUT"||n.type.toLowerCase()!=="file")return console.warn("MidiParser.addListener() : Provided element is not a valid FILE INPUT element"),!1;a=a||function(){},n.addEventListener("change",function(c){if(!c.target.files.length)return!1;console.log("MidiParser.addListener() : File detected in INPUT ELEMENT processing data..");let e=new FileReader;e.readAsArrayBuffer(c.target.files[0]),e.onload=function(d){a(s.Uint8(new Uint8Array(d.target.result)))}})},Base64:function(n){n=String(n);let a=u(n),c=a.length,e=new Uint8Array(new ArrayBuffer(c));for(let d=0;d<c;d++)e[d]=a.charCodeAt(d);return s.Uint8(e)},Uint8:function(n){let a={data:null,pointer:0,movePointer:function(t){return this.pointer+=t,this.pointer},readInt:function(t){if(t=Math.min(t,this.data.byteLength-this.pointer),t<1)return-1;let i=0;if(t>1)for(let r=1;r<=t-1;r++)i+=this.data.getUint8(this.pointer)*Math.pow(256,t-r),this.pointer++;return i+=this.data.getUint8(this.pointer),this.pointer++,i},readStr:function(t){let i=new Uint8Array(t);return i.forEach((r,l)=>{i[l]=this.readInt(1)}),i},backOne:function(){this.pointer--},readIntVLV:function(){let t=0;if(this.pointer>=this.data.byteLength)return-1;if(this.data.getUint8(this.pointer)<128)t=this.readInt(1);else{let i=[];for(;this.data.getUint8(this.pointer)>=128;)i.push(this.readInt(1)-128);let r=this.readInt(1);for(let l=1;l<=i.length;l++)t+=i[i.length-l]*Math.pow(128,l);t+=r}return t}};if(a.data=new DataView(n.buffer,n.byteOffset,n.byteLength),a.readInt(4)!==1297377380)return console.warn("Header validation failed (not MIDI standard or file corrupt.)"),!1;let c=a.readInt(4),e={};e.formatType=a.readInt(2),e.tracks=a.readInt(2),e.track=[];let d=a.readInt(1),h=a.readInt(1);d>=128?(e.timeDivision=[],e.timeDivision[0]=d-128,e.timeDivision[1]=h):e.timeDivision=d*256+h;for(let t=1;t<=e.tracks;t++){e.track[t-1]={event:[]};let i=a.readInt(4);if(i===-1)break;if(i!==1297379947)return!1;a.readInt(4);let r=0,l=!1,o,v;for(;!l&&(r++,e.track[t-1].event[r-1]={},e.track[t-1].event[r-1].deltaTime=a.readIntVLV(),o=a.readInt(1),o!==-1);)if(o>=128?v=o:(o=v,a.movePointer(-1)),o===255){e.track[t-1].event[r-1].type=255,e.track[t-1].event[r-1].metaType=a.readInt(1);let f=a.readIntVLV();switch(e.track[t-1].event[r-1].metaType){case 47:case-1:l=!0;break;case 1:case 2:case 3:case 4:case 5:case 7:case 6:e.track[t-1].event[r-1].data=a.readStr(f);break;case 33:case 89:case 81:e.track[t-1].event[r-1].data=a.readInt(f);break;case 84:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1),e.track[t-1].event[r-1].data[4]=a.readInt(1);break;case 88:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1),e.track[t-1].event[r-1].data[2]=a.readInt(1),e.track[t-1].event[r-1].data[3]=a.readInt(1);break;default:this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,f)),(this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)&&(a.readInt(f),e.track[t-1].event[r-1].data=a.readInt(f),this.debug&&console.info("Unimplemented 0xFF meta event! data block readed as Integer"))}}else switch(o=o.toString(16).split(""),o[1]||o.unshift("0"),e.track[t-1].event[r-1].type=parseInt(o[0],16),e.track[t-1].event[r-1].channel=parseInt(o[1],16),e.track[t-1].event[r-1].type){case 15:{if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].type,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1){let f=a.readIntVLV();e.track[t-1].event[r-1].data=a.readInt(f),this.debug&&console.info("Unimplemented 0xF exclusive events! data block readed as Integer")}break}case 10:case 11:case 14:case 8:case 9:e.track[t-1].event[r-1].data=[],e.track[t-1].event[r-1].data[0]=a.readInt(1),e.track[t-1].event[r-1].data[1]=a.readInt(1);break;case 12:case 13:e.track[t-1].event[r-1].data=a.readInt(1);break;case-1:l=!0;break;default:if(this.customInterpreter!==null&&(e.track[t-1].event[r-1].data=this.customInterpreter(e.track[t-1].event[r-1].metaType,a,!1)),this.customInterpreter===null||e.track[t-1].event[r-1].data===!1)return console.log("Unknown EVENT detected... reading cancelled!"),!1}}return e},customInterpreter:null};if(typeof I<"u")I.exports=s;else{let n=typeof window=="object"&&window.self===window&&window||typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;n.MidiParser=s}})()});p();})();
